<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>Issues/Debug Tips/Questions &mdash; PCIe Debug K-Map 1.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Documents and Debug Collaterals" href="links_docs_misc.html" />
    <link rel="prev" title="General Debug Checklist" href="debug_checklist.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../index.html" class="icon icon-home"> PCIe Debug K-Map
            <img src="../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">PCIe Debug (General)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../PCIe_Collaterals/index.html">PCIe Collaterals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCIe_Common_Issues/index.html">PCIe Common Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCIe_Debug_General_Techniques/index.html">PCIe General Debug Techniques</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Link_Training/index.html">Link Training Issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Simulation_Issue/index.html">Simulation Issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Interrupt/index.html">Interrupt Issue</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Versal ACAP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Versal_ACAP_CPM_Mode_for_PCI_Express/index.html">Versal ACAP CPM Mode for PCI Express</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Versal_ACAP_Integrated_Block_for_PCI_Express/index.html">Versal ACAP Integrated Block for PCI Express</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">UltraScale+</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../UltraScale%2B_Devices_Integrated_Block_for_PCIExpress/index.html">UltraScale+ Devices Integrated Block for PCIExpress</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">XDMA/Bridge Subsystem</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../DMA_Bridge_Subsystem_for_PCI_Express_XDMA_IP_Driver/index.html">DMA/Bridge Subsystem for PCI Express (XDMA IP/Driver)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../DMA_Bridge_Subsystem_for_PCI_Express_Bridge_IP_Endpoint/index.html">DMA/Bridge Subsystem for PCI Express (Bridge IP Endpoint)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">QDMA</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">QDMA Subsystem for PCIExpress (IP/Driver)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="qdma_debug_flow/index.html">QDMA Debug Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="qdma_debug_flow/src/debug_gotchas.html">Debug Gotchas</a></li>
<li class="toctree-l2"><a class="reference internal" href="debug_faq.html">General FAQs</a></li>
<li class="toctree-l2"><a class="reference internal" href="debug_checklist.html">General Debug Checklist</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Issues/Debug Tips/Questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="links_docs_misc.html">Documents and Debug Collaterals</a></li>
<li class="toctree-l2"><a class="reference internal" href="links_docs_misc.html#useful-links">Useful Links</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PS/PL PCIe RC Drivers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../PS_PCIe_PL_PCIe_Root_Port_Driver/index.html">Xilinx PCI Express (PS-PCIe/PL-PCIe) Drivers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PCIe Debug K-Map</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">QDMA Subsystem for PCIExpress (IP/Driver)</a> &raquo;</li>
      <li>Issues/Debug Tips/Questions</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/docs/QDMA_Subsystem_for_PCIExpress_IP_Driver/issue_q&amp;a_debug_tips.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="issues-debug-tips-questions">
<span id="qdma-issues-debug-tips-questions"></span><h1>Issues/Debug Tips/Questions<a class="headerlink" href="#issues-debug-tips-questions" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><dl class="simple">
<dt>Review the below links from QDMA Linux Driver Documentation; it might be helpful in debugging Linux driver issues:</dt><dd><ul>
<li><p>QDMA Debug File System Support <a class="reference external" href="https://xilinx.github.io/dma_ip_drivers/master/QDMA/linux-kernel/html/debugfs.html">https://xilinx.github.io/dma_ip_drivers/master/QDMA/linux-kernel/html/debugfs.html</a></p></li>
<li><p>QDMA Linux Driver Use Cases <a class="reference external" href="https://xilinx.github.io/dma_ip_drivers/master/QDMA/linux-kernel/html/qdma_usecases.html">https://xilinx.github.io/dma_ip_drivers/master/QDMA/linux-kernel/html/qdma_usecases.html</a></p></li>
<li><p>QDMA Linux Driver Design Flow <a class="reference external" href="https://xilinx.github.io/dma_ip_drivers/master/QDMA/linux-kernel/html/qdma_design.html">https://xilinx.github.io/dma_ip_drivers/master/QDMA/linux-kernel/html/qdma_design.html</a></p></li>
<li><p>DMA Control Application (dma-ctl) <a class="reference external" href="https://xilinx.github.io/dma_ip_drivers/master/QDMA/linux-kernel/html/dmactl.html">https://xilinx.github.io/dma_ip_drivers/master/QDMA/linux-kernel/html/dmactl.html</a></p></li>
<li><p>Linux Distributions and Kernel Versions Support <a class="reference external" href="https://xilinx.github.io/dma_ip_drivers/master/QDMA/linux-kernel/html/system-requirements.html">https://xilinx.github.io/dma_ip_drivers/master/QDMA/linux-kernel/html/system-requirements.html</a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Review the below links from QDMA DPDK Driver Documentation; it might be helpful in debugging DPDK driver issues:</dt><dd><ul>
<li><p>Linux Distributions and Kernel Versions Support <a class="reference external" href="https://xilinx.github.io/dma_ip_drivers/master/QDMA/DPDK/html/system-requirements.html">https://xilinx.github.io/dma_ip_drivers/master/QDMA/DPDK/html/system-requirements.html</a></p></li>
<li><p>QDMA DPDK Driver UseCases <a class="reference external" href="https://xilinx.github.io/dma_ip_drivers/master/QDMA/DPDK/html/qdma_usecases.html">https://xilinx.github.io/dma_ip_drivers/master/QDMA/DPDK/html/qdma_usecases.html</a></p></li>
<li><p>DPDK Driver debug <a class="reference external" href="https://xilinx.github.io/dma_ip_drivers/master/QDMA/DPDK/html/driver-design.html#dpdk-driver-debug">https://xilinx.github.io/dma_ip_drivers/master/QDMA/DPDK/html/driver-design.html#dpdk-driver-debug</a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>QDMA Driver failed to load (qdma:qdma_device_online: qdma_init failed -16.)</dt><dd><ul>
<li><p>Make sure to connect st_rx_msg_rdy, tm_dsc_sts_rdy and soft_reset_n to 1’b1</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>tm_dsc_sts_error reports error in h2c direction. The issue seems to occur after the first PIDX update write to QDMA.</dt><dd><ul>
<li><p>Make sure the Ring Size configuration is done correctly.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>CMPT Packet is not sent</dt><dd><ul>
<li><p>Review Software Context, Completion Context and Prefetch Context for each queue.</p></li>
<li><p>Review Software Context, Completion Context and Prefetch Context for each queue.</p></li>
<li><p>Which mode is used? Streaming mode or Memory Mapped mode?</p></li>
<li><p>How many queues are enabled?</p></li>
<li><p>How many packets are sent per queue?</p></li>
<li><p>What is the packet size?</p></li>
<li><p>When the issue occurs what happens when you do tear down? Does it timeout?</p></li>
<li><p>Is this custom driver or the driver downloaded from Xilinx github?</p></li>
<li><p>If it is Xilinx github, was there any modification done?</p></li>
<li><p>What commands were used to run the design? List all commands used. (This will help to reproduce the issue locally if feasible)</p></li>
<li><p>Is this Internal mode or Descriptor bypass mode?</p></li>
<li><p>Is C2H Prefetch enabled?</p></li>
<li><p>How many Queues is the QDMA configured for? Which queues are being used?</p></li>
<li><p>What are mask registers set to? Review all mask registers. (Note: ‘1’ means the interrupt corresponding to that bit is enabled. Even though the mask bits are set to ‘0’, the errors are still set in the corresponding registers. Only the interrupts are not propagated to the aggregator).</p></li>
<li><p>Is the issue deterministic? Does it happen always after sending certain number of packets?</p></li>
<li><p>what is the status of tm_dsc_sts_vld signal? [QDMA Traffic Manager Credit Output Ports Interface]</p></li>
<li><p>What is the Vivado version being used?</p></li>
<li><dl class="simple">
<dt>Create a counter outside of the IP to count the packets sent to QDMA IP and compare them with the value reported by the QDMA registers:</dt><dd><ul>
<li><p>QDMA_C2H_STAT_S_AXIS_C2H_ACCEPTED (0xA88) (Number of C2H packet accepted from the user application)</p></li>
<li><p>QDMA_C2H_STAT_S_AXIS_CMPT_ACCEPTED (0xA8C) (Number of C2H completion packet accepted from the user application)</p></li>
<li><p>QDMA_C2H_STAT_DESC_RSP_PKT_ACCEPTED (0xA90) (Number of descriptor response packets accepted)</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Check if s_axis_c2h_ctrl_has_cmpt and s_axis_c2h_cmpt_ctrl_cmpt_type are same or not</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>C2H Hang</dt><dd><ul>
<li><p>Is the C2H transfer hitting 4K boundery in host memory when the hang occurs?</p></li>
<li><p>What is the status of s_axis_c2h_tready and s_axis_c2h_cmpt_tready signals?</p></li>
<li><p>Do you have console log before the hang occurs?</p></li>
<li><p>In the test, is it only C2H traffic or there is H2C traffic as well?</p></li>
<li><p>How many queues are active when the hang occurs?</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>qdma_hw_error_handler( ): Detected Invalid PIDX update error</dt><dd><ul>
<li><dl class="simple">
<dt>There could be two reasons for this issue:</dt><dd><ul>
<li><p>PIDX update if bigger than the Ring size</p></li>
<li><p>There are no descriptors in the ring and DMA is trying to fetch more descriptors. If there are descriptors or not, look at the context dump for PIDX and CIDX. If they are at same level, it tells the ring is empty, the driver needs to post more descriptors.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Questions:</dt><dd><ul>
<li><p>Do you see packet drops on AXI side? Check the register dump. Check AXI4-Stream Status Ports (axis_c2h_status_error, axis_c2h_status_drop)</p></li>
<li><p>Dump register from 0xA80 to 0xBF4.</p></li>
<li><dl class="simple">
<dt>Do you see if there are any error bit sets in completion entry?</dt><dd><ul>
<li><p>“Detected Completion queue gets full error” if the completion queue is full then there should be any error bit set completion entry.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>If the packets are being dropped on AXI side, it might be due to lack of descriptors.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>AXI_ST C2H block needs to be designed with ‘QDMA Traffic Manager Credit Output Ports (tm_dsc_sts_*). Confirm this has been done or not. (Note: tm_dsc_sts_* signals must be used in both internal mode or bypass mode in order not to drop any packets. )  These ports give how many credit are there for a given Q and so how many packets can the user send to QDMA. If a user sends more packets than the number of credits available then QDMA will drop those packets.</p></li>
<li><p>Check 0XB10 (QDMA_C2H_STAT_DESC_RSP_DROP_ACCEPTED) register. It gives number of packets that are dropped.</p></li>
<li><p>What is the Stream packet size (like 64 or 256 bytes, etc)?</p></li>
<li><dl class="simple">
<dt>For smaller packet sizes like 64bytes all these 4 registers should have same value for a good transfer (0xA88, 0xA8C, 0XA90 and 0xA94)</dt><dd><ul>
<li><p>QDMA_C2H_STAT_S_AXIS_C2H_ACCEPTED (0XA88) - Number of C2H packet accepted from the userapplication.</p></li>
<li><p>QDMA_C2H_STAT_S_AXIS_CMPT_ACCEPTED (0xA8C) - Number of C2H completion packet accepted from the user application.</p></li>
<li><p>QDMA_C2H_STAT_DESC_RSP_PKT_ACCEPTED (0xA90) - Number of descriptor response packets accepted.</p></li>
<li><p>QDMA_C2H_STAT_AXIS_PKG_CMP (0xA94) - The number of C2H packets completed from the C2H DMA write engine.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Make sure the user logic is feeding the same QID to C2H and CMPT.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>QDMA IP not detected in lspci</dt><dd><ul>
<li><dl class="simple">
<dt>Check the following signals in ILA:</dt><dd><ul>
<li><p>user_link_up, axi_aresetn, soft_reset_n, phy_ready</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>axis_c2h_status_drop is asserted</dt><dd><ul>
<li><p>Check if desc_rsp_err is set or not in QDMa_C2H_ERR_STAT</p></li>
<li><dl class="simple">
<dt>Check the following registers:</dt><dd><ul>
<li><p>QDMA_C2H_DROP_LEN_MISMATCH (0xBB4)</p></li>
<li><p>QDMA_C2H_DROP_DESC_RSP_LEN (0xBB8)</p></li>
<li><p>QDMA_C2H_DROP_QID_FIFO_LEN (0xBBC)</p></li>
<li><p>QDMA_C2H_DROP_PAYLOAD_CNT (0xBB0)</p></li>
<li><p>Interrupt Decode 2 Register (0xE38)</p></li>
<li><p>C2H_PACKETS_DROP (0x088)</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Make sure the descriptor is still available; check tm_dsc_sts_error/tm_dsc_sts_avl</p></li>
<li><p>Make sure PIDX/CIDX is updated correctly</p></li>
<li><p>Check s_axis_c2h_tready</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="debug_checklist.html" class="btn btn-neutral float-left" title="General Debug Checklist" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="links_docs_misc.html" class="btn btn-neutral float-right" title="Documents and Debug Collaterals" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2022, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on October 24, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>