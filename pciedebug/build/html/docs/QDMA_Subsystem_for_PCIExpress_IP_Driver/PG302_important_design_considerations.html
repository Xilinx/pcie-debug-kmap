<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>Important Design Considerations from PG302 &mdash; PCIe Debug K-Map 1.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Important Design Considerations from PG344" href="PG344_important_design_considerations.html" />
    <link rel="prev" title="Documents and Debug Collaterals" href="links_docs_misc.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../index.html" class="icon icon-home"> PCIe Debug K-Map
            <img src="../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">PCIe Debug (General)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../PCIe_Collaterals/index.html">PCIe Collaterals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCIe_Common_Issues/index.html">PCIe Common Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCIe_Debug_General_Techniques/index.html">PCIe General Debug Techniques</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Link_Training/index.html">Link Training Issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Simulation_Issue/index.html">Simulation Issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Interrupt/index.html">Interrupt Issue</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Versal ACAP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Versal_ACAP_CPM_Mode_for_PCI_Express/index.html">Versal ACAP CPM Mode for PCI Express</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Versal_ACAP_Integrated_Block_for_PCI_Express/index.html">Versal ACAP Integrated Block for PCI Express</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">UltraScale+</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../UltraScale%2B_Devices_Integrated_Block_for_PCIExpress/index.html">UltraScale+ Devices Integrated Block for PCIExpress</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">XDMA/Bridge Subsystem</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../DMA_Bridge_Subsystem_for_PCI_Express_XDMA_IP_Driver/index.html">DMA/Bridge Subsystem for PCI Express (XDMA IP/Driver)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../DMA_Bridge_Subsystem_for_PCI_Express_Bridge_IP_Endpoint/index.html">DMA/Bridge Subsystem for PCI Express (Bridge IP Endpoint)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">QDMA</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">QDMA Subsystem for PCIExpress (IP/Driver)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="qdma_debug_flow/index.html">QDMA Debug Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="qdma_debug_flow/src/debug_gotchas.html">Debug Gotchas</a></li>
<li class="toctree-l2"><a class="reference internal" href="debug_faq.html">General FAQs</a></li>
<li class="toctree-l2"><a class="reference internal" href="links_docs_misc.html">Documents and Debug Collaterals</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Important Design Considerations from PG302</a></li>
<li class="toctree-l2"><a class="reference internal" href="PG344_important_design_considerations.html">Important Design Considerations from PG344</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="qdma_conceptual_topics/index.html">QDMA Conceptual Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="qdma_debug_topics/index.html">QDMA Debug Topics</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Embedded PCI Express</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../PS_PCIe_PL_PCIe_Root_Port_Driver/index.html">Documentation &amp; Debugging Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PS_PCIe_PL_PCIe_Root_Port_Driver/Versal_CPM5_PCIe_Root_Port_Design_Linux/index.html">Versal CPM5 PCIe Root Port Design (Linux)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PS_PCIe_PL_PCIe_Root_Port_Driver/MPSoC_PL_XDMA_Bridge_RC_Design_Bare_Metal/index.html">MPSoC PL XDMA Bridge Bare Metal Root Complex Design</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PCIe Debug K-Map</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">QDMA Subsystem for PCIExpress (IP/Driver)</a> &raquo;</li>
      <li>Important Design Considerations from PG302</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/docs/QDMA_Subsystem_for_PCIExpress_IP_Driver/PG302_important_design_considerations.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="important-design-considerations-from-pg302">
<span id="pg302-important-design-considerations"></span><h1>Important Design Considerations from PG302<a class="headerlink" href="#important-design-considerations-from-pg302" title="Permalink to this heading">¶</a></h1>
<div class="introduction docutils container">
<p>When tackling design issues, navigating a lengthy product guide can be overwhelming. To streamline your troubleshooting process, this article lists essential design considerations directly from the product guide, highlighting key points to keep in mind. This article condenses over 200 pages into a focused, 10-12 page summary, making it easier to access the most relevant information quickly. For full details, be sure to click the provided link to explore each consideration further in the original product guide.</p>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<ul>
<li><p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Descriptor-Engine?tocId=IapAFAz_pMIftrJvFO5TaQ">https://docs.amd.com/r/en-US/pg302-qdma/Descriptor-Engine?tocId=IapAFAz_pMIftrJvFO5TaQ</a></p>
<blockquote>
<div><ul class="simple">
<li><p>If a queue is associated with interrupt aggregation, AMD recommends that the status descriptor be turned off, and instead the DMA status be received from the interrupt aggregation ring.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<ul>
<li><p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/H2C-Stream-Engine?tocId=5bP1owSpu0KFRSL~uEv2lQ">https://docs.amd.com/r/en-US/pg302-qdma/H2C-Stream-Engine?tocId=5bP1owSpu0KFRSL~uEv2lQ</a></p>
<blockquote>
<div><ul class="simple">
<li><p>The total length of all descriptors put together must be less than 64 KB.</p></li>
<li><p>For internal mode queues, each descriptor defines a single AXI4-Stream packet to be transferred to the H2C AXI-ST interface. A packet with multiple descriptors straddling is not allowed due to the lack of per queue storage. However, packets with multiple descriptors straddling can be implemented using the descriptor bypass mode.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<ul>
<li><p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/C2H-Stream-Engine?tocId=w7xytGq781SYeea3XB7G3A">https://docs.amd.com/r/en-US/pg302-qdma/C2H-Stream-Engine?tocId=w7xytGq781SYeea3XB7G3A</a></p>
<blockquote>
<div><ul class="simple">
<li><p>In Simple Bypass Mode, the engine does not track anything for the queue, and the user logic can define its own method to receive descriptors. The user logic is then responsible for delivering the packet and associated descriptor through the simple bypass interface. The ordering of the descriptors fetched by a queue in the bypass interface and the C2H stream interface must be maintained across all queues in bypass mode.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<ul>
<li><p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/AXI-Memory-Mapped-Bridge-Master-Interface">https://docs.amd.com/r/en-US/pg302-qdma/AXI-Memory-Mapped-Bridge-Master-Interface</a></p>
<blockquote>
<div><ul class="simple">
<li><p>One or more PCIe BAR of any physical function (PF) or virtual function (VF) can be mapped to the AXI-MM bridge master interface. This selection must be made prior to design compilation.</p></li>
<li><p>Virtual function group (VFG) refers to the VF group number. It is equivalent to the PF number associated with the corresponding VF. VFG_OFFSET refers to the VF number with respect to a particular PF. Note that this is not the FIRST_VF_OFFSET of each PF.</p></li>
<li><p>Note that all VFs belonging to the same PF share the same PCIe to AXI translation vector. Therefore, the AXI address space of each VF is concatenated together. Use VFG_OFFSET to calculate the actual starting address of AXI for a particular VF.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<ul>
<li><p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/PCIe-RQ/RC">https://docs.amd.com/r/en-US/pg302-qdma/PCIe-RQ/RC</a></p>
<blockquote>
<div><ul class="simple">
<li><p>With a 512-bit interface, straddling is enabled. While straddling is supported, all combinations of RQ straddled transactions might not be implemented.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<ul>
<li><p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/General-Design-of-Queues">https://docs.amd.com/r/en-US/pg302-qdma/General-Design-of-Queues</a></p>
<blockquote>
<div><ul class="simple">
<li><p>If queue size is 8, which contains the entry index 0 to 7, the last entry (index 7) is reserved for status. This index should never be used for PIDX update, and PIDX update should never be equal to CIDX. For this case, if CIDX is 0, the maximum PIDX update would be 6.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<ul>
<li><p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Limitations">https://docs.amd.com/r/en-US/pg302-qdma/Limitations</a></p>
<blockquote>
<div><ul class="simple">
<li><p>Use AXI SmartConnect to support Narrow Burst.</p></li>
<li><p>ECC and Slave Narrow Burst support is mutually exclusive.</p></li>
<li><p>If you want an ECC feature, the recommendation is to up-size your AXI Master externally.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<ul>
<li><p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Performance-and-Resource-Utilization">https://docs.amd.com/r/en-US/pg302-qdma/Performance-and-Resource-Utilization</a></p>
<blockquote>
<div><ul class="simple">
<li><p>Global register for timer should have a value of 30 for 3 μs.</p></li>
<li><p>The driver should update TX/RX PIDX in batches of 64.</p></li>
<li><p>The driver should update the H2C PIDX in batches of 64, and also update for the last descriptor of the scatter gather list.</p></li>
<li><p>For optimal QDMA streaming performance, packet buffers of the descriptor ring should be aligned to at least 256 bytes.</p></li>
<li><p>AMD recommends that you limit the total outstanding descriptor fetch to be less than 8 KB on the PCIe. For example, limit the outstanding credits across all queues to 512 for a 16B descriptor.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<ul>
<li><p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Performance-and-Resource-Utilization">https://docs.amd.com/r/en-US/pg302-qdma/Performance-and-Resource-Utilization</a></p>
<blockquote>
<div><ul class="simple">
<li><p>AMD recommends that this port be asserted once in 32 packets or 64 packets. And if there are no more descriptors left then assert h2c_byp_in_st_sdi at the last descriptor. This requirement is per queue basis, and applies to AXI4 (H2C and C2H) bypass transfers and AXI4-Stream H2C transfers.</p></li>
<li><p>For AXI4-Stream C2H Simple bypass mode, the dsc_crdt_in_fence port should be set to 1 for performance reasons. This recommendation assumes the user design already coalesced credits for each queue and sent them to the IP. In internal mode, set the fence bit in the QDMA_C2H_PFCH_CFG_2 (0xA84) register.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<ul>
<li><p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Descriptor-Context">https://docs.amd.com/r/en-US/pg302-qdma/Descriptor-Context</a></p>
<blockquote>
<div><ul class="simple">
<li><p>Prior to enabling the queue, the hardware and credit context must first be cleared. After this is done, the software context can be programmed and the qen bit can be set to enable the queue. After the queue is enabled, the software context should only be updated through the direct mapped address space to update the Producer Index and Interrupt Arm® bit, unless the queue is being disabled.</p></li>
<li><p>Reading the context when the queue is enabled is not recommended as it can result in reduced performance.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<ul>
<li><p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Software-Descriptor-Context-Structure-0x0-C2H-and-0x1-H2C">https://docs.amd.com/r/en-US/pg302-qdma/Software-Descriptor-Context-Structure-0x0-C2H-and-0x1-H2C</a></p>
<blockquote>
<div><ul class="simple">
<li><p>irq_req: Interrupt due to error waiting to be sent (waiting for irq_arm). This bit should be cleared when the queue context is initialized.</p></li>
<li><p>err_wb_sent: A writeback/interrupt was sent for an error. Once this bit is set no more writebacks or interrupts will be sent for the queue. This bit should be cleared when the queue context is initialized.</p></li>
<li><p>irq_no_last: This bit should be initialized to 0 when the queue context is initialized.</p></li>
<li><p>dsc_sz: If bypass mode is not enabled, 32B is required for Memory Mapped DMA, 16B is required for H2C Stream DMA, and 8B is required for C2H Stream DMA.</p></li>
<li><p>fetch_max: The max outstanding is fetch_max + 1. Higher value can increase the single queue performance.</p></li>
<li><p>fcrd_en: Set to 1 for C2H ST.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Descriptor-Engine?tocId=IapAFAz_pMIftrJvFO5TaQ">https://docs.amd.com/r/en-US/pg302-qdma/Descriptor-Engine?tocId=IapAFAz_pMIftrJvFO5TaQ</a></p>
<ul class="simple">
<li><p>If a queue is associated with interrupt aggregation, AMD recommends that the status descriptor be turned off, and instead the DMA status be received from the interrupt aggregation ring.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/H2C-Stream-Engine?tocId=5bP1owSpu0KFRSL~uEv2lQ">https://docs.amd.com/r/en-US/pg302-qdma/H2C-Stream-Engine?tocId=5bP1owSpu0KFRSL~uEv2lQ</a></p>
<ul class="simple">
<li><p>The total length of all descriptors put together must be less than 64 KB.</p></li>
<li><p>For internal mode queues, each descriptor defines a single AXI4-Stream packet to be transferred to the H2C AXI-ST interface. A packet with multiple descriptors straddling is not allowed due to the lack of per queue storage. However, packets with multiple descriptors straddling can be implemented using the descriptor bypass mode.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/C2H-Stream-Engine?tocId=w7xytGq781SYeea3XB7G3A">https://docs.amd.com/r/en-US/pg302-qdma/C2H-Stream-Engine?tocId=w7xytGq781SYeea3XB7G3A</a></p>
<ul class="simple">
<li><p>In Simple Bypass Mode, the engine does not track anything for the queue, and the user logic can define its own method to receive descriptors. The user logic is then responsible for delivering the packet and associated descriptor through the simple bypass interface. The ordering of the descriptors fetched by a queue in the bypass interface and the C2H stream interface must be maintained across all queues in bypass mode.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/AXI-Memory-Mapped-Bridge-Master-Interface">https://docs.amd.com/r/en-US/pg302-qdma/AXI-Memory-Mapped-Bridge-Master-Interface</a></p>
<ul class="simple">
<li><p>One or more PCIe BAR of any physical function (PF) or virtual function (VF) can be mapped to the AXI-MM bridge master interface. This selection must be made prior to design compilation.</p></li>
<li><p>Virtual function group (VFG) refers to the VF group number. It is equivalent to the PF number associated with the corresponding VF. VFG_OFFSET refers to the VF number with respect to a particular PF. Note that this is not the FIRST_VF_OFFSET of each PF.</p></li>
<li><p>Note that all VFs belonging to the same PF share the same PCIe to AXI translation vector. Therefore, the AXI address space of each VF is concatenated together. Use VFG_OFFSET to calculate the actual starting address of AXI for a particular VF.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/PCIe-RQ/RC">https://docs.amd.com/r/en-US/pg302-qdma/PCIe-RQ/RC</a></p>
<ul class="simple">
<li><p>With a 512-bit interface, straddling is enabled. While straddling is supported, all combinations of RQ straddled transactions might not be implemented.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/General-Design-of-Queues">https://docs.amd.com/r/en-US/pg302-qdma/General-Design-of-Queues</a></p>
<ul class="simple">
<li><p>If queue size is 8, which contains the entry index 0 to 7, the last entry (index 7) is reserved for status. This index should never be used for PIDX update, and PIDX update should never be equal to CIDX. For this case, if CIDX is 0, the maximum PIDX update would be 6.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Limitations">https://docs.amd.com/r/en-US/pg302-qdma/Limitations</a></p>
<ul class="simple">
<li><p>Use AXI SmartConnect to support Narrow Burst.</p></li>
<li><p>ECC and Slave Narrow Burst support is mutually exclusive.</p></li>
<li><p>If you want an ECC feature, the recommendation is to up-size your AXI Master externally.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Performance-and-Resource-Utilization">https://docs.amd.com/r/en-US/pg302-qdma/Performance-and-Resource-Utilization</a></p>
<ul class="simple">
<li><p>Global register for timer should have a value of 30 for 3 μs.</p></li>
<li><p>The driver should update TX/RX PIDX in batches of 64.</p></li>
<li><p>The driver should update the H2C PIDX in batches of 64, and also update for the last descriptor of the scatter-gather list.</p></li>
<li><p>For optimal QDMA streaming performance, packet buffers of the descriptor ring should be aligned to at least 256 bytes.</p></li>
<li><p>AMD recommends that you limit the total outstanding descriptor fetch to be less than 8 KB on the PCIe. For example, limit the outstanding credits across all queues to 512 for a 16B descriptor.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Performance-and-Resource-Utilization">https://docs.amd.com/r/en-US/pg302-qdma/Performance-and-Resource-Utilization</a></p>
<ul class="simple">
<li><p>AMD recommends that this port be asserted once in 32 packets or 64 packets. And if there are no more descriptors left then assert h2c_byp_in_st_sdi at the last descriptor. This requirement is per queue basis, and applies to AXI4 (H2C and C2H) bypass transfers and AXI4-Stream H2C transfers.</p></li>
<li><p>For AXI4-Stream C2H Simple bypass mode, the dsc_crdt_in_fence port should be set to 1 for performance reasons. This recommendation assumes the user design already coalesced credits for each queue and sent them to the IP. In internal mode, set the fence bit in the QDMA_C2H_PFCH_CFG_2 (0xA84) register.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Descriptor-Context">https://docs.amd.com/r/en-US/pg302-qdma/Descriptor-Context</a></p>
<ul class="simple">
<li><p>Prior to enabling the queue, the hardware and credit context must first be cleared. After this is done, the software context can be programmed and the qen bit can be set to enable the queue. After the queue is enabled, the software context should only be updated through the direct mapped address space to update the Producer Index and Interrupt Arm® bit, unless the queue is being disabled.</p></li>
<li><p>Reading the context when the queue is enabled is not recommended as it can result in reduced performance.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Software-Descriptor-Context-Structure-0x0-C2H-and-0x1-H2C">https://docs.amd.com/r/en-US/pg302-qdma/Software-Descriptor-Context-Structure-0x0-C2H-and-0x1-H2C</a></p>
<ul class="simple">
<li><p>irq_req: Interrupt due to error waiting to be sent (waiting for irq_arm). This bit should be cleared when the queue context is initialized.</p></li>
<li><p>err_wb_sent: A writeback/interrupt was sent for an error. Once this bit is set no more writebacks or interrupts will be sent for the queue. This bit should be cleared when the queue context is initialized.</p></li>
<li><p>irq_no_last: This bit should be initialized to 0 when the queue context is initialized.</p></li>
<li><p>dsc_sz: If bypass mode is not enabled, 32B is required for Memory Mapped DMA, 16B is required for H2C Stream DMA, and 8B is required for C2H Stream DMA.</p></li>
<li><p>fetch_max: The max outstanding is fetch_max + 1. Higher value can increase the single queue performance.</p></li>
<li><p>fcrd_en: Set to 1 for C2H ST.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Descriptor-Fetch">https://docs.amd.com/r/en-US/pg302-qdma/Descriptor-Fetch</a></p>
<ul class="simple">
<li><p>If fetch crediting is enabled, the user logic is required to provide a credit for each descriptor that should be fetched.</p></li>
<li><p>In each direction, C2H and H2C are allocated 256 entries for descriptor fetch completions. Each entry is the width of the datapath. If sufficient space is available, the fetch is allowed to proceed. A given queue can only have one descriptor fetch pending on PCIe at any time.</p></li>
<li><p>Available descriptors are always - 2. At any time, the software should not update the PIDX to more than - 2.</p></li>
<li><p>If queue size is 8, which contains the entry index 0 to 7, the last entry (index 7) is reserved for status. This index should never be used for the PIDX update, and the PIDX update should never be equal to CIDX. For this case, if CIDX is 0, the maximum PIDX update would be 6.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Internal-Mode-Writeback-and-Interrupts-AXI-MM-and-H2C-ST">https://docs.amd.com/r/en-US/pg302-qdma/Internal-Mode-Writeback-and-Interrupts-AXI-MM-and-H2C-ST</a></p>
<ul class="simple">
<li><p>It is recommended the wbi_chk bit be set for all internal mode operation, including when interval mode is enabled.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Descriptor-Bypass-Mode-Writeback/Interrupts">https://docs.amd.com/r/en-US/pg302-qdma/Descriptor-Bypass-Mode-Writeback/Interrupts</a></p>
<ul class="simple">
<li><p>If interrupts are enabled, the user logic must monitor the traffic manager output for the irq_arm. After the irq_arm bit is observed for the queue, a descriptor with the sdi bit is sent to the DMA. Once a descriptor with the sdi bit is sent, another irq_arm assertion must be observed before another descriptor with the sdi bit can be sent.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Traffic-Manager-Output-Interface">https://docs.amd.com/r/en-US/pg302-qdma/Traffic-Manager-Output-Interface</a></p>
<ul class="simple">
<li><p>While the tm_dsc_sts interface is a valid/ready interface, it should not be back-pressured for optimal performance.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Errors?tocId=RVdoy7Fzh1DBbxgMq3ytwg">https://docs.amd.com/r/en-US/pg302-qdma/Errors?tocId=RVdoy7Fzh1DBbxgMq3ytwg</a></p>
<ul class="simple">
<li><p>After the queue is invalidated, if there is an error you can determine the cause by reading the error registers and context for that queue. You must clear and remove that queue, and then add the queue back later when needed.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Operation">https://docs.amd.com/r/en-US/pg302-qdma/Operation</a></p>
<ul class="simple">
<li><p>Any descriptors that have already started the source buffer fetch will continue to be processed. Reassertion of the run bit will result in resetting internal engine state and should only be done when the engine is quiesced.</p></li>
<li><p>Descriptors are received from either the descriptor engine directly or the Descriptor Bypass Input interface. Any queue that is in internal mode should not be given descriptors through the Descriptor Bypass Input interface.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/AXI-Memory-Mapped-Descriptor-for-H2C-and-C2H-32B">https://docs.amd.com/r/en-US/pg302-qdma/AXI-Memory-Mapped-Descriptor-for-H2C-and-C2H-32B</a></p>
<ul class="simple">
<li><p>Internal mode memory mapped DMA must configure the descriptor queue to be 32B and follow the above descriptor format.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Internal-and-Bypass-Modes">https://docs.amd.com/r/en-US/pg302-qdma/Internal-and-Bypass-Modes</a></p>
<ul class="simple">
<li><p>If the packet is present in host memory in non-contiguous space, then it has to be defined by more than one descriptor, and this requires that the queue be programmed in bypass mode.</p></li>
<li><p>When fcrd_en is enabled in the software context, DMA will wait for the user application to provide credits. When fcrd_en is not set, the DMA uses a pointer update, fetches descriptors and sends the descriptor out. The user application should not send in credits.</p></li>
<li><p>There are some requirements imposed on the user logic when using the bypass mode. Because the bypass mode allows a packet to span multiple descriptors, the user logic needs to indicate to QDMA which descriptor marks the Start-Of-Packet (SOP) and which marks the End-Of-Packet (EOP).</p></li>
<li><p>At the QDMA H2C Stream bypass-in interface, among other pieces of information, the user logic needs to provide: Address, Length, SOP, and EOP. It is required that once the user logic feeds SOP descriptor information into QDMA, it must eventually feed EOP descriptor information also. Descriptors for these multi-descriptor packets must be fed in sequentially.</p></li>
<li><p>Other descriptors not belonging to the packet must not be interleaved within the multi-descriptor packet. The user logic must accumulate the descriptors up to the EOP descriptor, before feeding them back to QDMA. Not doing so can result in a hang.</p></li>
<li><p>The QDMA will generate a TLAST at the QDMA H2C AXI4-Stream data output once it issues the last beat for the EOP descriptor. This is guaranteed because the user is required to submit the descriptors for a given packet sequentially.</p></li>
<li><p>Quality of service can be severely affected if the packet sizes are large. The Stream engine is designed to saturate PCIe for packet sizes as low as 128B, so AMD recommends that you restrict the packet size to be host page size or maximum transfer unit as required by the user application.</p></li>
<li><p>A performance control provided in the H2C Stream Engine is the ability to stall requests from being issued to the PCIe RQ/RC if a certain amount of data is outstanding on the PCIe side as seen by the H2C Stream Engine. To use this feature, the SW must program a threshold value in the H2C_REQ_THROT (0xE24) register.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Handling-Descriptors-With-Errors?tocId=C1GC1G3Yi2rqbFYc6COtCg">https://docs.amd.com/r/en-US/pg302-qdma/Handling-Descriptors-With-Errors?tocId=C1GC1G3Yi2rqbFYc6COtCg</a></p>
<ul class="simple">
<li><p>For a queue in bypass mode, it is the responsibility of the user logic to not issue a batch of descriptors with an error descriptor. Instead, it must send just one descriptor with error input asserted on the H2C Stream bypass-in interface and set the SOP, EOP, no_dma signal, and sdi or mrkr-req signal to make the H2C Stream Engine send a writeback to Host.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/C2H-Stream-Engine?tocId=iIzB4_5EQe28ijZNG1QubA">https://docs.amd.com/r/en-US/pg302-qdma/C2H-Stream-Engine?tocId=iIzB4_5EQe28ijZNG1QubA</a></p>
<ul class="simple">
<li><p>The QDMA requires software to post full ring size so the C2H stream engine can fetch the needed number of descriptors for all received packets. If there are not enough descriptors in the descriptor ring, the QDMA will stall the packet transfer. For performance reasons, the software is required to post the PIDX as soon as possible to ensure there are always enough descriptors in the ring.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/C2H-Stream-Modes">https://docs.amd.com/r/en-US/pg302-qdma/C2H-Stream-Modes</a></p>
<ul class="simple">
<li><p>If you already have the descriptor cached on the device, there is no need to fetch one from the host and you should follow the simple bypass mode for the C2H Stream application. In simple bypass mode, do not provide credits to fetch the descriptor, and instead, you need to send in the descriptor on the descriptor bypass interface.</p></li>
<li><p>For simple bypass transfer to work, a prefetch tag is needed and it can be fetched from the QDMA IP.</p></li>
<li><p>The user application must request a prefetch tag before sending any traffic for a simple bypass queue through the C2H ST engine. Invalid queues or non-bypass queues should not request any tags using this method, as it might reduce performance by freezing tags that never get used.</p></li>
<li><p>For the queues that share the same prefetch tag, the data and descriptors need to come in the same order. For Simple Bypass, the data and descriptors are both controlled by the user, so they need to guarantee the order is maintained.</p></li>
<li><p>If a current qid is invalidated, a new prefetch tag must be requested with a valid qid.</p></li>
<li><p>Prefetched tag must be assigned to input port c2h_byp_in_st_csh_pfch_tag[6:0] for all transfers.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/C2H-Stream-Packet-Type">https://docs.amd.com/r/en-US/pg302-qdma/C2H-Stream-Packet-Type</a></p>
<ul class="simple">
<li><p>dma&lt;n&gt;_s_axis_c2h_mty = empty byte should be set in last beat.</p></li>
<li><p>dma&lt;n&gt;_s_axis_c2h_cmpt_ctrl_wait_pld_pkt_id = This completion packet has to wait for the data packet with this ID to be sent before the CMPT packet can be sent.</p></li>
<li><p>When the user application sends the data packet, it must count the packet ID for each packet. The first data packet has a packet ID of 1, and it increments for each data packet.</p></li>
<li><p>For the regular C2H packet, the data packet and the completion packet is a one-to-one match. Therefore, the number of data packets with dma&lt;n&gt;_s_axis_c2h_ctrl_has_cmpt as 1’b1 should be equal to the number of CMPT packets with dma&lt;n&gt;_s_axis_c2h_cmpt_ctrl_cmpt_type as HAS_PLD.</p></li>
<li><p>Depth and width of the FIFO depends on the use case. Width is dependent on the largest CMPT size for the application, and depth is dependent on performance needs. For best performance for 64 Byte CMPT, a depth of 512 is recommended.</p></li>
<li><p>The immediate data packet and the marker packet do not consume the descriptor; instead, they write to the C2H Completion Ring. The software needs to size the C2H Completion Ring large enough to accommodate the outstanding immediate packets and the marker packets.</p></li>
<li><p>Zero Byte packets are not supported in Internal mode and Cache bypass mode. The QDMA might hang if zero byte packets are dropped due to not available descriptors. Zero Byte Packets are supported in Simple bypass mode.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/C2H-Stream-Modes">https://docs.amd.com/r/en-US/pg302-qdma/C2H-Stream-Modes</a></p>
<ul class="simple">
<li><p>When prefetch mode is enabled, the user application cannot send credits as input in QDMA Descriptor Credit input ports.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Completion-Engine?tocId=N~lHogTrZWEFBwBMSKiHgw">https://docs.amd.com/r/en-US/pg302-qdma/Completion-Engine?tocId=N~lHogTrZWEFBwBMSKiHgw</a></p>
<ul class="simple">
<li><p>The user-defined portion of the CMPT packet typically needs to specify the length of the data packet transferred and whether or not descriptors were consumed as a result of the data packet transfer. Immediate and marker type packets do not consume any descriptors. The exact contents of the user-defined data are up to the user to determine.</p></li>
<li><p>Maximum buffer size register 0xB50 bits[31:26] is programmed to 0 (default value). This value might result in an overflow depending on the simulator or the synthesis tool used. To avoid overflow, set 0xB50 bits[31:26] to maximum value of 63.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Completion-Status-Structure">https://docs.amd.com/r/en-US/pg302-qdma/Completion-Status-Structure</a></p>
<ul class="simple">
<li><p>In order to make the QDMA Subsystem for PCIe write Completion Status to the Completion ring, Completion Status must be enabled in the Completion context.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Completion-Context-Structure">https://docs.amd.com/r/en-US/pg302-qdma/Completion-Context-Structure</a></p>
<ul class="simple">
<li><p>baddr4_low: Since the minimum alignment supported is 64B in this case, this field must be 0.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Slave-Bridge">https://docs.amd.com/r/en-US/pg302-qdma/Slave-Bridge</a></p>
<ul class="simple">
<li><p>If slave reads and writes are valid, IP prioritizes reads over writes. You are recommended to have proper arbitration (leave some gaps between reads so writes can pass through).</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Slave-Address-Translation-Examples">https://docs.amd.com/r/en-US/pg302-qdma/Slave-Address-Translation-Examples</a></p>
<ul class="simple">
<li><p>The slave bridge does not support narrow burst AXI transfers. To avoid narrow burst transfers, connect the AXI smart-connect module which will convert narrow burst to full burst AXI transfers.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Function-Map-Table">https://docs.amd.com/r/en-US/pg302-qdma/Function-Map-Table</a></p>
<ul class="simple">
<li><p>Along with FMAP table programming in the IP, you must program the FMAP table in the Mailbox IP. This is needed for function level reset (FLR) procedure.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Queue-Setup">https://docs.amd.com/r/en-US/pg302-qdma/Queue-Setup</a></p>
<ul class="simple">
<li><p>Set-up Completion Context. If interrupts/status writes are desired (enabled in the Completion Context), an initial Completion CIDX update is required to send the hardware into a state where it is sensitive to trigger conditions. This initial CIDX update is required, because when out of reset, the hardware initializes into an unarmed state.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Function-Level-Reset">https://docs.amd.com/r/en-US/pg302-qdma/Function-Level-Reset</a></p>
<ul class="simple">
<li><p>When a VF is reset, only the resources associated with this VF are reset. When a PF is reset, all resources of the PF, including that of its associated VFs, are reset. Because FLR is a privileged operation, it must be performed by the PF driver running in the management system.</p></li>
<li><p>Quiesce: The software must ensure all pending transaction is completed. This can be done by polling the Transaction Pending bit in the Device Status register (in PCIe Configuration Space), until it is cleared or times out after a certain period of time.</p></li>
<li><p>Initiate Function Level Reset bit (bit 15 of PCIe Device Control Register) of the target function should be set to 1 to trigger FLR process in PCIe.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Host-Profile">https://docs.amd.com/r/en-US/pg302-qdma/Host-Profile</a></p>
<ul class="simple">
<li><p>Host profile must be programmed to represent root port host. Host profile can be programmed through context programming.</p></li>
<li><p>H2C AXI4-MM steering bit and C2H AXI4-MM steering bit should set to 0s. If not, DMA AXI4-MM transfers do not work. For most cases, host profile context structure is all 0s, and host profile must still be programmed to represent a host.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Resets">https://docs.amd.com/r/en-US/pg302-qdma/Resets</a></p>
<ul class="simple">
<li><p>After soft_reset, you must reinitialize the queues and program all queue context.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Expansion-ROM">https://docs.amd.com/r/en-US/pg302-qdma/Expansion-ROM</a></p>
<ul class="simple">
<li><p>The maximum size for the Expansion ROM BAR should be no larger than 16 MB. Selecting an address space larger than 16 MB can result in a non-compliant core.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Data-Path-Errors">https://docs.amd.com/r/en-US/pg302-qdma/Data-Path-Errors</a></p>
<ul class="simple">
<li><p>Parity errors are not recoverable and can result in unexpected behavior. Any DMA during and after the parity error should be considered invalid.</p></li>
<li><p>If there is a parity error and transfer hangs or stops, the DMA will log the error. You must investigate and fix the parity issues. Once the issues are fixed, clear that queue and reopen the queue to start a new transfer.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/QDMA-Global-Ports">https://docs.amd.com/r/en-US/pg302-qdma/QDMA-Global-Ports</a></p>
<ul class="simple">
<li><p>sys_clk should be driven by the ODIV2 port of reference clock IBUFDS_GTE4.</p></li>
<li><p>PCIe reference clock should be driven from the port of reference clock IBUFDS_GTE4.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/AXI-Bridge-Slave-Ports">https://docs.amd.com/r/en-US/pg302-qdma/AXI-Bridge-Slave-Ports</a></p>
<ul class="simple">
<li><p>Only the INCR burst type is supported.</p></li>
<li><p>s_axib_wstrb can be equal to 0 in the beginning of a valid data cycle and will appropriately calculate an offset to the given address. However, the valid data identified by s_axib_wstrb must be continuous from the first byte enable to the last byte enable.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/QDMA-Descriptor-Bypass-Input-Ports">https://docs.amd.com/r/en-US/pg302-qdma/QDMA-Descriptor-Bypass-Input-Ports</a></p>
<ul class="simple">
<li><p>QDMA hangs if the last descriptor without h2c_byp_in_st_sdi has an error. This results in a missing writeback and hw_ctxt.dsc_pend bit that are asserted indefinitely.</p></li>
<li><p>For performance reasons, AMD recommends that this port be asserted once in 32 or 64 descriptors and assert at the last descriptor if there are no more descriptors left.</p></li>
<li><p>In Cache Bypass mode, you must loop back c2h_byp_out_pfch_tag[6:0] to c2h_byp_in_st_csh_pfch_tag[6:0]. In Simple Bypass mode, you need to pass in the Prefetch tag value from MDMA_C2H_PFCH_BYP_TAG (0x140C) register.</p></li>
<li><p>AXI4-Stream C2H Simple Bypass mode and Cache Bypass mode both use the same bypass ports, c2h_byp_in_st_csh_*.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/QDMA-Descriptor-Bypass-Output-Ports">https://docs.amd.com/r/en-US/pg302-qdma/QDMA-Descriptor-Bypass-Output-Ports</a></p>
<ul class="simple">
<li><p>h2c_byp_out_rdy: When this interface is not used, Ready must be tied-off to 1.</p></li>
<li><p>h2c_byp_out_cidx [15:0]: The ring index of the descriptor fetched. The User must echo this field back to QDMA when submitting the descriptor on the bypass-in interface.</p></li>
<li><p>c2h_byp_out_cidx [15:0]: The ring index of the descriptor fetched. The User must echo this field back to QDMA when submitting the descriptor on the bypass-in interface.</p></li>
<li><p>c2h_byp_out_rdy: When this interface is not used, Ready must be tied-off to 1.</p></li>
<li><p>When Descriptor bypass option is selected in the AMD Vivado™ IDE but the descriptor bypass bit is not set in context programming, you will see valid signals getting asserted with CIDX updates.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/QDMA-Descriptor-Credit-Input-Ports">https://docs.amd.com/r/en-US/pg302-qdma/QDMA-Descriptor-Credit-Input-Ports</a></p>
<ul class="simple">
<li><p>dsc_crdt_in_fence: The fence bit should only be set for a queue that is enabled and has both descriptors and credits available; otherwise, a hang condition might occur.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/QDMA-Traffic-Manager-Credit-Output-Ports">https://docs.amd.com/r/en-US/pg302-qdma/QDMA-Traffic-Manager-Credit-Output-Ports</a></p>
<ul class="simple">
<li><p>tm_dsc_sts_rdy: When this interface is not used, Ready must be tied-off to 1.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Queue-Status-Ports">https://docs.amd.com/r/en-US/pg302-qdma/Queue-Status-Ports</a></p>
<ul class="simple">
<li><p>qsts_out_rdy: Ready must be tied to 1 so status output will not be blocked. Even if this interface is not used, the ready port must be tied to 1.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Registering-Signals">https://docs.amd.com/r/en-US/pg302-qdma/Registering-Signals</a></p>
<ul class="simple">
<li><p>To simplify timing and increase system performance in a programmable device design, keep all inputs and outputs registered between the user application and the subsystem. This means that all inputs and outputs from the user application should come from, or connect to, a flip-flop. While registering signals might not be possible for all paths, it simplifies timing analysis and makes it easier for the AMD tools to place and route the design.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Recognize-Timing-Critical-Signals">https://docs.amd.com/r/en-US/pg302-qdma/Recognize-Timing-Critical-Signals</a></p>
<ul class="simple">
<li><p>The constraints provided with the example design identify the critical signals and timing constraints that should be applied.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Make-Only-Allowed-Modifications">https://docs.amd.com/r/en-US/pg302-qdma/Make-Only-Allowed-Modifications</a></p>
<ul class="simple">
<li><p>You should not modify the subsystem. Any modifications can have adverse effects on system timing and protocol compliance. Supported user configurations of the subsystem can only be made by selecting the options in the customization IP dialog box when the subsystem is generated.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/AXI-BARs-Tab">https://docs.amd.com/r/en-US/pg302-qdma/AXI-BARs-Tab</a></p>
<ul class="simple">
<li><p>No Address Translation: When this option is selected, the DMA will not do any address translation. One full 64-bit BAR space is provided, and you are responsible for any address translation if required. When address translation is required by DMA, do not select this option.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/PCIe-DMA-Tab">https://docs.amd.com/r/en-US/pg302-qdma/PCIe-DMA-Tab</a></p>
<ul class="simple">
<li><dl class="simple">
<dt>CMPT Coalesce Max buffer:</dt><dd><ul>
<li><p>Completion (CMPT) Coalesce Max buffer supports up to 64 buffers. Select one of 16 or 32 (default 16). Each entry of the CMPT Coalesce Buffer coalesces multiple Completions (up to 64B) to form a single queue before writing to the host to improve bandwidth utilization. A deeper CMPT Coalesce Buffer allows coalescing within more queues but will increase the area as a downside.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Data Protection:</dt><dd><ul>
<li><dl class="simple">
<dt>When Data Protection is not enabled:</dt><dd><ul>
<li><p>You must always give the parity on CMPT.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>When Data Protection is enabled:</dt><dd><ul>
<li><p>You must send CRC/ECC values on C2H data and the control interface.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Example-Design-with-Descriptor-Bypass-In/Out-Loopback">https://docs.amd.com/r/en-US/pg302-qdma/Example-Design-with-Descriptor-Bypass-In/Out-Loopback</a></p>
<ul class="simple">
<li><p>After the setup initial C2H stream data transfer, the prefetch tag is valid until the qid is valid. When the current qid becomes invalid, you must generate a new tag.</p></li>
</ul>
</div>
<div class="highlight-box admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.amd.com/r/en-US/pg302-qdma/Using-the-Drivers">https://docs.amd.com/r/en-US/pg302-qdma/Using-the-Drivers</a></p>
<ul class="simple">
<li><p>Note: Starting from the 2022.1 release of the Linux driver for QDMA, if a design is using streaming queues, they must be explicitly enabled through API as they are not configured at module load.</p></li>
</ul>
</div>
</div>


           </div>
          </div>
          
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="links_docs_misc.html" class="btn btn-neutral float-left" title="Documents and Debug Collaterals" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="PG344_important_design_considerations.html" class="btn btn-neutral float-right" title="Important Design Considerations from PG344" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2022, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on October 24, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>